%%
%% InterruptLab (c) 2021-23 Christopher A. Bohn
%%
%% Licensed under the Apache License, Version 2.0 (the "License");
%% you may not use this file except in compliance with the License.
%% You may obtain a copy of the License at
%%     http://www.apache.org/licenses/LICENSE-2.0
%% Unless required by applicable law or agreed to in writing, software
%% distributed under the License is distributed on an "AS IS" BASIS,
%% WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
%% See the License for the specific language governing permissions and
%% limitations under the License.
%%

\input{../../common/assignment}
\input{../../common/semester}
\input{../../common/storylines}
\usepackage{amsmath}
%\usepackage{array,color,colortbl}
\definecolor{LightGreen}{rgb}{0.88,1,0.88}
\usepackage{multicol}
\usepackage{CJKutf8}
\usepackage{gensymb}
\setlength{\columnsep}{2cm}


% \captionsetup{width=.8\linewidth}

% \lstset{language=c, numbers=left, showstringspaces=false,
%     moredelim = [s][\ttfamily]{/*}{*/} % I shouldn't need this parameter!
%     }

\renewcommand{\labnumber}{\interruptlabnumber}
\renewcommand{\labname}{Using Interrupt-Driven Input/Output}
\renewcommand{\shortlabname}{interrupt-driven i/o -- interruptlab}
\renewcommand{\collaborationrules}{\interruptlabcollaboration}
\renewcommand{\duedate}{\interruptlabdue}
\newcommand{\nano}{\developmentboard} % TODO: replace \nano with \developmentboard
\renewcommand{\runtimeenvironment}{\interruptlabenvironment}
\pagelayout
\begin{document}
    \labidentifier

    \pdfbookmark[1]{Frontmatter}{frontmatter}                   \input{frontmatter}

    \softwareengineeringfrontmatter

    \section*{Scenario}                                         %\DisdainfulHerb \NumberConversionTool
                                                                \LessDisdainfulHerb \RemoteControlledCar

    \section{Assignment Summary}                                \input{assignmentsummary}

    \section{Getting Started} \label{sec:GettingStarted}        \input{gettingstarted}

    \section{Cart Controller Specification} \label{sec:spec}    \input{specification}

    \section{Turn Signals} \label{sec:turnSignals}              \input{turn_signals}

    \section{Controlling the Cart} \label{sec:cartController}   \input{cart_controller}

    \section{Turn-in and Grading}                               \input{grading}

    \section*{Epilogue}                                         \LauraDern

    \textit{To be continued...}

%    \newpage\appendix
    \appendix

    \section{Appendix: Lab Checkoff}                            \input{checkoff}

\end{document}





%Please familiarize yourself with the entire assignment before beginning.
%Section~\ref{sec:FunctionalSpecification} has the functional specification of
%the system system you will develop. Section~\ref{sec:Constraints} describes
%implementation constraints. Section~\ref{sec:Paradigm} relates interrupt-driven
%I/O to event-driven programming (which you should have learned about in \cstwo).
%Section~\ref{sec:GettingStarted} identifies code that you can reuse from PollingLab.
%Section~\ref{sec:TimerInterrupts} will guide you through configuring a hardware
%timer and responding to interrupts from that timer.
%Section~\ref{sec:ExternalInterrupts} will guide you through registering and writing
%interrupt service routines for external interrupts. Finally,
%Sections~\ref{sec:ConversionTimeout} and \ref{sec:BuildingAndConverting} offers
%suggestions for using your interrupt service routines to implement the system's
%specifications.












%\section*{Turn-in and Grading}\addcontentsline{toc}{section}{Rubric}
%
%When you have completed this assignment, upload \textit{InterruptLab.ino} to
%\filesubmission.
%
%This assignment is worth 40 points. \\
%
%Rubric:
%\begin{description}
%\item[Pushbutton Interrupts]
%\rubricitem{4}{Pushbutton presses and releases are detected with an external
%    interrupt.}
%\rubricitem{2}{The pushbuttons' interrupt handler determines which button was
%    released.}
%\rubricitem{2}{The pushbuttons' interrupt handler determines whether the left
%    button has been double-clicked.}
%\item[Matrix Keypad Interrupts]
%\rubricitem{4}{Matrix keypad presses are detected with an external interrupt.}
%\rubricitem{2}{The keypad's interrupt handler determines which key was pressed.}
%\item[Timer Interrupts]
%\rubricitem{2}{Timer interrupts for Timer1 or Timer2 are enabled and handled.}
%\rubricitem{4}{The timer interrupts configured such that, when combined with
%    other logic, the software is able to determine when exactly 7.5~seconds or
%    exactly 20~seconds have passed since the left button was double-clicked.}
%\item[Conversion Timeout]
%\rubricitem{2}{The system is able to determine when exactly 7.5~seconds have
%    passed since the left button was double-clicked.}
%\rubricitem{2}{The system is able to determine when exactly 20~seconds have
%    passed since the left button was double-clicked.}
%\item[Building Numbers]
%\rubricitem{3}{Builds a value consistent with
%    requirements~\ref{spec:initallyZero}--\ref{spec:noLeadingZeroes}.
%    (\textthreequarters\ point for each of: displaying correct positive decimal
%    values, displaying correct negative decimal values, displaying correct
%    positive hexadecimal values, displaying correct negative hexadecimal
%    values)}
%\rubricitem{1}{Negates value when left pushbutton is released. (\textonequarter\
%    point for each of: displaying correct positive decimal values, displaying
%    correct negative decimal values, displaying correct positive hexadecimal
%    values, displaying correct negative hexadecimal values)}
%\rubricitem{1}{Releasing the right pushbutton clears all digits on the Display
%    Module except the least-significant digit, which displays {\dviiseg 0}.}
%\rubricitem{1}{Detects and displays correct message when the number being built
%    is too big. (\textonehalf\ point for detecting too-big numbers;
%    \textonequarter\ point for no false detections; \textonequarter\ point for
%    displaying the correct message)}
%\item[Converting Numbers]
%\rubricitem{2}{Converts from decimal to hexadecimal when the left button is
%    double-clicked. (1 point for correctly-displayed positive numbers; 1 point
%    for correctly-displayed negative numbers)}
%\rubricitem{2}{Converts from hexadecimal to decimal when the left button is
%    double-clicked. (1 point for correctly-displayed positive numbers; 1 point
%    for correctly-displayed negative numbers)}
%\rubricitem{1}{Displays the number in its original number base 7.5~seconds or
%    20~seconds (as appropriate) after displaying the converted number.}
%\rubricitem{1}{Detects and displays correct message when the number being
%    converted to the other number base is too great for the new number base.}
%\rubricitem{1}{Displays the number in its original number base 7.5~seconds or
%    20~seconds (as appropriate) after displaying the error message.}
%\rubricitem{1}{The external LED illuminates while and only while the converted
%    number (or the convered error message) is displayed.}
%\item[Other Requirements]
%\rubricitem{1}{The number being built does not change when a button is pressed.}
%\rubricitem{1}{If the left button is double-clicked, then the number being built
%    does not change when the button is released.}
%\bonusitem{2}{Get assignment checked-off by TA or professor during office hours
%    before it is due. (You cannot get both bonuses.)}
%\bonusitem{1}{Get assignment checked-off by TA at \textit{start} of your
%    scheduled lab immediately after it is due. (Your code must be uploaded to
%    \filesubmission\ \textit{before} it is due. You cannot get both bonuses.)}
%\item[Penalties]
%\penaltyitem{0}{No penalty needed for ``Pushbutton Interrupts,'' ``Matrix Keypad
%    Interrupts,'' or ``Timer Interrupts'' portions of rubric since credit for
%    these parts of the rubric is not possible without complying with the
%    constraints in Section~\ref{sec:Constraints}.}
%\penaltyitem{4}{Code associated with conversion timeout (other than that
%    covered in the first penalty item) relies on code that violates the
%    constraints in Section~\ref{sec:Constraints}.}
%\penaltyitem{6}{Code associated with building numbers (other than that
%    covered in the first penalty item) relies on code that violates the
%    constraints in Section~\ref{sec:Constraints}.}
%\penaltyitem{8}{Code associated with converting numbers (other than that
%    covered in the first two penalty items) relies on code that violates the
%    constraints in Section~\ref{sec:Constraints}.}
%\penaltyitem{2}{Code associated with certain button actions having no effect
%    (other than that covered in the first penalty item) relies on code that
%    violates the constraints in Section~\ref{sec:Constraints}.}
%\spaghetticodepenalties{1}
%\end{description}
%%
%
%
%
%
%\section*{Appendix: Lab Checkoff}\addcontentsline{toc}{section}{Lab Checkoff}
%
%You are not required to have your assignment checked-off by a TA or the
%professor. If you do not do so, then we will perform a functional check
%ourselves. In the interest of making grading go faster, we are offering a small
%bonus to get your assignment checked-off at the start of your scheduled lab
%time immediately after it is due. Because checking off all students during lab
%would take up most of the lab time, we are offering a slightly larger bonus if
%you complete your assignment early and get it checked-off by a TA or the
%professor during office hours.
%
%\begin{description}
%\precheckoffitem{Establish that the code you are demonstrating is the code
%    you submitted to to \filesubmission.}
%    \begin{itemize}
%    \item If you are getting checked-off during lab time, show the TA that the
%        file was submitted before it was due.
%    \item Download the file into your PollingLab directory. If necessary,
%        rename it to \textit{InterruptLab.ino}.
%    \end{itemize}
%\precheckoffitem{Upload \textit{InterruptLab.ino} to your \nano\ and open the
%    Serial Monitor.}
%\end{description}
%
%\begin{enumerate}
%\checkoffitem{Show in your code that your \function{loop()} function has no
%    executable code, and that there is not an infinite loop in the
%    \function{setup()} fuction, nor in any functions called by
%    \function{setup()}.} \\
%    \textit{establishing this now allows us to conclude that the observed
%    functionality is in the ISRs or their helper functions}
%\checkoffitem{Show in your code that you registered interrupt handlers for
%    the pushbuttons and for the matrix keypad.} \\
%    \textit{make note of the interrupt condition}
%\checkoffitem{Show in your code your interrupt handlers for the pushbuttons and
%    for the matrix keypad.} \\
%    \textit{+4 pushbutton presses and releases are detected with an external
%    interrupt \\
%    \phantom{xxx}(if a single handler is registered for pushbutton CHANGEs, or \\
%    \phantom{xxx}if handlers are registered for both FALLING and RISING
%    pushbuttons)} \\
%    \textit{+4 matrix keypad presses are detected with an external interrupt}
%\checkoffitem{Show and explain how you determined the comparison value and
%    prescaler for your timer interrupts.}
%\checkoffitem{Show in your code that you had configured the timer to use
%    those comparison and prescaler values and that you had configured the
%    correct timer mode.} \\
%    \textit{+4 timer interrupts are configured correctly}
%\checkoffitem{Show in your code that you enabled the correct timer.}
%\checkoffitem{Show in your code that you created an ISR for the correct
%    timer.} \\
%    \textit{+2 timer interrupts are enabled and handled}
%\checkoffitem{Place the right switch in the left (decimal) position.}
%\checkoffitem{Press 1. One of two things will happen:}
%    \begin{itemize}
%    \item 1 appears on the Serial Monitor.
%    \item {\dviiseg 1} appears on the display module.
%    \end{itemize}
%    \textit{+2 keypad ISR determines which key was pressed}
%\checkoffitem{Press the left pushbutton. The Serial Monitor may indicate that
%    the left pushbutton is DOWN and the right pushbutton is UP, but there is
%    no other observable behavior.}
%\checkoffitem{Release the left pushbutton. One or both of two things will
%    happen:}
%    \begin{itemize}
%    \item The Serial Monitor indicates that both pushbuttons are UP.
%    \item {\dviiseg -1} appears on the display module.
%    \end{itemize}
%\checkoffitem{Press the right pushbutton. The Serial Monitor may indicate that
%    the right pushbutton is DOWN and the left pushbutton is UP, but there is
%    no other observable behavior.} \\
%    \textit{+1 The number being build does not change when a button is pressed.}
%\checkoffitem{Release right pushbutton. One or both of two things will
%    happen:}
%    \begin{itemize}
%    \item The Serial Monitor indicates that both pushbuttons are UP.
%    \item {\dviiseg 0} appears on the display module.
%    \end{itemize}
%    \textit{+2 pushbutton ISR determines which button was released}
%\checkoffitem{Place the right switch in the right (hexadecimal) position. Place
%    the right switch in the left (7.5~seconds) position.}
%\checkoffitem{Press A. {\dviiseg A} may appear on the display module.}
%\checkoffitem{Double-click the left pushbutton. One or more of three things will
%    happen:}
%    \begin{itemize}
%    \item The Serial Monitor indicates that a double-click occurred.
%    \item The display will update to {\dviiseg 10} or an attempt to do so, such
%        as {\dviiseg 0} or {\dviiseg 1}.
%    \item The external LED illuminates.
%    \end{itemize}
%    \textit{+2 pushbutton ISR determines whether the left button is
%    double-clicked} \\
%\checkoffitem{Wait 7.5~seconds. One or more of three things will happen:}
%    \begin{itemize}
%    \item The Serial Monitor indicates that 7.5~seconds have elapsed.
%    \item The display will revert to {\dviiseg A} or an attempt to do so.
%    \item The external LED deluminates.
%    \end{itemize}
%    \textit{+2 system determines when 7.5~seconds have passed} \\
%    \textit{+1 external LED illuminates while and only while converted number is
%    displayed} \\
%% \checkoffitem{Release both buttons. The Serial Monitor may briefly indicate that
%%     one button is DOWN and the other is UP, and it may indicate that both
%%     buttons are UP, but there is no other observable behavior.} \\
%    \textit{+1 the number being built does not change when the left button is
%    released during a double-click}
%\checkoffitem{Place the left switch in the left (20~seconds) position.}
%\checkoffitem{Double-click the left pushbutton. One or more of the
%    previously-mentioned indications of simultaneous button presses happen.}
%\checkoffitem{Wait 20~seconds. One or more of the previously-mentioned
%    indications of conversion timeout happen.} \\
%    \textit{+2 system determines when 20~seconds have passed}
%\checkoffitem{Place the left switch in the right (7.5~seconds) position.}
%\checkoffitem{Press and release the right pushbutton. The output is {\dviiseg 0}
%    on the display module.}
%\checkoffitem{Enter the value 0x123A. The output is {\dviiseg\phantom{8888}123A}
%    on the display module.} \\
%    \textit{+\textthreequarters\ displays correct positive hexadecimal values}
%\checkoffitem{Press the and release the left pushbutton. The output is
%    {\dviiseg FFFFEDC6} on the display module.} \\
%    \textit{+\textonequarter\ correctly negates positive hexadecimal values}
%\checkoffitem{Press and release the right pushbutton. The output is {\dviiseg 0}
%    on the display module.}
%    \textit{+1 releasing the right pushbutton clears all digits and then
%        displays {\dviiseg 0}}
%\checkoffitem{Enter the value 0xB654789C. The output is {\dviiseg B654789C}
%    on the display module.} \\
%    \textit{+\textthreequarters\ displays correct negative hexadecimal values}
%\checkoffitem{Press the and release the left pushbutton. The output is
%    {\dviiseg 49AB8764} on the display module.} \\
%    \textit{+\textonequarter\ correctly negates negative hexadecimal values}
%\checkoffitem{Place the right switch in the left (decimal) position.}
%\checkoffitem{Press and release the right pushbutton. The output is {\dviiseg 0}
%    on the display module.}
%\checkoffitem{Enter the value 1478. The output is {\dviiseg\phantom{8888}1478}
%    on the display module.} \\
%    \textit{+\textthreequarters\ displays correct positive decimal values}
%\checkoffitem{Press the and release the left pushbutton. The output is
%    {\dviiseg\phantom{888}-1478} on the display module.} \\
%    \textit{+\textonequarter\ correctly negates positive decimal values}
%\checkoffitem{Press and release the right pushbutton. The output is {\dviiseg 0}
%    on the display module.}
%\checkoffitem{Enter the value -5236. The output is {\dviiseg\phantom{888}-5236}
%    on the display module.} \\
%    \textit{+\textthreequarters\ displays correct negative decimal values}
%\checkoffitem{Press the and release the left pushbutton. The output is
%    {\dviiseg\phantom{8888}5236} on the display module.} \\
%    \textit{+\textonequarter\ correctly negates negative decimal values}
%\checkoffitem{Press and release the right pushbutton. The output is {\dviiseg 0}
%    on the display module.}
%\checkoffitem{Enter the value 12369874. The output is {\dviiseg 12369874} on
%    the display module.} \\
%    \textit{+\textonequarter\ no false ``too big'' detections}
%\checkoffitem{Press 0. The output is {\dviiseg\phantom{8}too big} on the display
%    module.} \\
%    \textit{+\textonehalf\ detects that a number is ``too big''} \\
%    \textit{+\textonequarter\ displays correct error message}
%\checkoffitem{Press and release the right pushbutton. The output is {\dviiseg 0}
%    on the display module.}
%\checkoffitem{Enter the value 1234. The output is {\dviiseg\phantom{8888}1234}
%    on the display module.}
%\checkoffitem{Double-click the left pushbutton. The output is
%    {\dviiseg\phantom{88888}4D2} on the display module.} \\
%    \textit{+1 converts positive decimal to hexadecimal}
%\checkoffitem{Wait 7.5~seconds for the conversion to timeout. The output is
%    {\dviiseg\phantom{8888}1234} on the display module.} \\
%    \textit{+\textonequarter\ the original positive decimal number displays after
%    timeout}
%\checkoffitem{Press and release the left pushbutton. The output is
%    {\dviiseg\phantom{888}-1234} on the display module.}
%\checkoffitem{Double-click the left pushbutton. The output is
%    {\dviiseg FFFFFB2E} on the display module.} \\
%    \textit{+1 converts negative decimal to hexadecimal}
%\checkoffitem{Wait 7.5~seconds for the conversion to timeout. The output is
%    {\dviiseg\phantom{888}-1234} on the display module.} \\
%    \textit{+\textonequarter\ the original negative decimal number displays after
%    timeout}
%\checkoffitem{Press and release the right pushbutton. The output is {\dviiseg 0}
%    on the display module.}
%\checkoffitem{Place the right switch in the right (hexadecimal) position.}
%\checkoffitem{Enter the value 0x56B7. The output is
%    {\dviiseg\phantom{8888}56B7} on the display module.}
%\checkoffitem{Double-click the left pushbutton. The output is
%    {\dviiseg\phantom{888}22199} on the display module.} \\
%    \textit{+1 converts positive hexadecimal to decimal}
%\checkoffitem{Wait 7.5~seconds for the conversion to timeout. The output is
%    {\dviiseg\phantom{8888}56B7} on the display module.} \\
%    \textit{+\textonequarter\ the original positive hexadecimal number displays
%    after timeout}
%\checkoffitem{Press and release the left pushbutton. The output is
%    {\dviiseg FFFFA949} on the display module.}
%\checkoffitem{Double-click the left pushbutton. The output is
%    {\dviiseg\phantom{88}-22199} on the display module.} \\
%    \textit{+1 converts negative hexadecimal to decimal}
%\checkoffitem{Wait 7.5~seconds for the conversion to timeout. The output is
%    {\dviiseg FFFFA949} on the display module.} \\
%    \textit{+\textonequarter\ the original negative hexadecimal number displays
%    after timeout}
%\checkoffitem{Press and release the right pushbutton. The output is {\dviiseg 0}
%    on the display module.}
%\checkoffitem{Enter the value 0x6A0,0000. The output is
%    {\dviiseg\phantom{8}6A00000} on the display module.}
%\checkoffitem{Double-click the left pushbutton. The output is
%    {\dviiseg\phantom{888}ERROR} on the display module.} \\
%    \textit{+\textonehalf\ detects that converted number is too great to
%    display} \\
%    \textit{+\textonequarter\ displays correct error message}
%\checkoffitem{Wait 7.5~seconds for the conversion to timeout. The output is
%    {\dviiseg\phantom{8}6A00000} on the display module.} \\
%    \textit{+1 the original number displays after timeout}
%\checkoffitem{Press and release the right pushbutton. The output is {\dviiseg 0}
%    on the display module.}
%\checkoffitem{Enter the value 0x5F5,E0FF. The output is
%    {\dviiseg\phantom{8}5F5E0FF} on the display module.}
%\checkoffitem{Double-click the left pushbutton. The output is
%    {\dviiseg 99999999} on the display module.} \\
%    \textit{+\textonequarter\ no false ``error'' detections}
%\end{enumerate}
%
%This concludes the demonstration of your system's functionality. The TAs will
%later examine your code for violations of the assignment's constraints. If your
%code looks like it is tailored for this checklist, the TAs may re-grade using a
%different checklist.
